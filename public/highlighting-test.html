<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Text Highlighting & Drag-Drop Test</title>
    <link rel="stylesheet" href="/styles-neon.css">
    <style>
        body { padding: 20px; background: #111; color: white; }
        .test-section { 
            margin: 20px 0; 
            padding: 20px; 
            border: 1px solid #555; 
            border-radius: 8px;
        }
        .test-text {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            line-height: 1.6;
        }
        .test-result {
            background: #2a2a2a;
            color: #00ff88;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
        }
        /* Test highlight styles */
        .highlight-manipulation { background: rgba(255, 0, 128, 0.3); color: #ff0080; }
        .highlight-cognitive_bias { background: rgba(255, 234, 0, 0.3); color: #ffea00; }
        .highlight-rhetorical_fallacy { background: rgba(0, 255, 136, 0.3); color: #00ff88; }
        
        .drag-source {
            background: #333;
            padding: 10px;
            margin: 5px;
            border-radius: 5px;
            cursor: move;
            border: 1px solid #555;
        }
        .drag-source:hover { background: #444; }
        .drop-zone {
            background: #2a2a2a;
            border: 2px dashed #666;
            padding: 20px;
            margin: 10px 0;
            border-radius: 5px;
            min-height: 100px;
        }
        .drop-zone.drag-over { 
            border-color: #a855f7; 
            background: rgba(168, 85, 247, 0.1);
        }
    </style>
</head>
<body>
    <!-- Required system elements -->
    <div id="login-screen" style="display: none;"></div>
    <div id="app-container" style="display: block;">
    
        <h1>üé® Text Highlighting & Drag-Drop Test</h1>
        
        <div class="test-section">
            <h2>Test 1: Text Highlighting Colors</h2>
            <div class="test-text">
                <p>–¶–µ–π —Ç–µ–∫—Å—Ç –º—ñ—Å—Ç–∏—Ç—å <span class="highlight-manipulation">–º–∞–Ω—ñ–ø—É–ª—è—Ü—ñ—ó (—Ä–æ–∂–µ–≤–∏–π –∫–æ–ª—ñ—Ä)</span> —Ç–∞ <span class="highlight-cognitive_bias">–∫–æ–≥–Ω—ñ—Ç–∏–≤–Ω—ñ –≤–∏–∫—Ä–∏–≤–ª–µ–Ω–Ω—è (–∂–æ–≤—Ç–∏–π –∫–æ–ª—ñ—Ä)</span>.</p>
                <p>–¢–∞–∫–æ–∂ —î <span class="highlight-rhetorical_fallacy">—Å–æ—Ñ—ñ–∑–º–∏ —Ç–∞ –ª–æ–≥—ñ—á–Ω—ñ –ø–æ–º–∏–ª–∫–∏ (–∑–µ–ª–µ–Ω–∏–π –∫–æ–ª—ñ—Ä)</span> –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó.</p>
            </div>
            <button onclick="testHighlighting()" class="test-button">Test Dynamic Highlighting</button>
            <div class="test-result" id="highlighting-result"></div>
        </div>
        
        <div class="test-section">
            <h2>Test 2: Drag and Drop Functionality</h2>
            
            <h3>Drag Sources:</h3>
            <div class="drag-source" draggable="true" data-type="manipulation" data-content="–ü—Ä–∏–∫–ª–∞–¥ –º–∞–Ω—ñ–ø—É–ª—è—Ü—ñ—ó">
                üî¥ Manipulation Fragment (Drag me!)
            </div>
            <div class="drag-source" draggable="true" data-type="bias" data-content="–ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫—Ä–∏–≤–ª–µ–Ω–Ω—è">
                üü° Cognitive Bias Fragment (Drag me!)  
            </div>
            <div class="drag-source" draggable="true" data-type="fallacy" data-content="–ü—Ä–∏–∫–ª–∞–¥ —Å–æ—Ñ—ñ–∑–º—É">
                üü¢ Rhetorical Fallacy Fragment (Drag me!)
            </div>
            
            <h3>Drop Zone:</h3>
            <div class="drop-zone" id="test-drop-zone">
                <p>Drop fragments here to test drag & drop functionality</p>
                <div id="dropped-items"></div>
            </div>
            
            <div class="test-result" id="dragdrop-result"></div>
        </div>
        
        <div class="test-section">
            <h2>Test 3: Analysis Text Processing</h2>
            <textarea id="negotiation-text" placeholder="Paste text here to test highlighting..." rows="5" style="width: 100%; background: #1a1a1a; color: white; border: 1px solid #555; padding: 10px; border-radius: 5px;"></textarea>
            <br><br>
            <button onclick="processTestText()" class="test-button">Process Text for Highlights</button>
            <div id="processed-text" class="test-text"></div>
            <div class="test-result" id="processing-result"></div>
        </div>
        
        <!-- System elements -->
        <div id="client-form" style="display: none;"></div>
        <div id="analysis-dashboard" style="display: none;"></div>
        <div id="results-section" style="display: none;"></div>
        <div id="notifications"></div>
        <div id="fulltext-content"></div>
        <div id="highlights-list"></div>
        <div id="selected-fragments"></div>
    
    </div>
    
    <script>
        // Authentication simulation
        sessionStorage.setItem('teampulse-auth', 'true');
        
        function logResult(elementId, message, isError = false) {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const statusClass = isError ? 'error' : 'success';
            const statusIcon = isError ? '‚ùå' : '‚úÖ';
            element.innerHTML += `<div class="${statusClass}">${statusIcon} [${timestamp}] ${message}</div>`;
        }
        
        // Test 1: Dynamic Highlighting
        function testHighlighting() {
            logResult('highlighting-result', 'Testing dynamic highlighting...');
            
            // Test CSS classes exist
            const testElement = document.createElement('span');
            testElement.className = 'highlight-manipulation';
            testElement.textContent = 'Test';
            document.body.appendChild(testElement);
            
            const styles = window.getComputedStyle(testElement);
            const bgColor = styles.backgroundColor;
            const color = styles.color;
            
            logResult('highlighting-result', `Manipulation highlight - Background: ${bgColor}, Color: ${color}`);
            document.body.removeChild(testElement);
            
            // Test other highlight classes
            ['highlight-cognitive_bias', 'highlight-rhetorical_fallacy'].forEach(className => {
                const elem = document.createElement('span');
                elem.className = className;
                document.body.appendChild(elem);
                const compStyles = window.getComputedStyle(elem);
                logResult('highlighting-result', `${className} - BG: ${compStyles.backgroundColor}, Color: ${compStyles.color}`);
                document.body.removeChild(elem);
            });
        }
        
        // Test 2: Drag and Drop
        function setupDragAndDrop() {
            const dragSources = document.querySelectorAll('.drag-source');
            const dropZone = document.getElementById('test-drop-zone');
            const droppedItems = document.getElementById('dropped-items');
            
            // Set up drag sources
            dragSources.forEach(source => {
                source.addEventListener('dragstart', (e) => {
                    const data = {
                        type: source.dataset.type,
                        content: source.dataset.content,
                        text: source.textContent
                    };
                    e.dataTransfer.setData('text/plain', JSON.stringify(data));
                    logResult('dragdrop-result', `Drag started: ${source.dataset.type}`);
                });
            });
            
            // Set up drop zone
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('drag-over');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                
                try {
                    const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                    logResult('dragdrop-result', `Dropped: ${data.type} - "${data.content}"`);
                    
                    const droppedItem = document.createElement('div');
                    droppedItem.style.cssText = 'background: #444; padding: 8px; margin: 5px 0; border-radius: 3px; border-left: 3px solid #a855f7;';
                    droppedItem.textContent = `${data.type}: ${data.content}`;
                    droppedItems.appendChild(droppedItem);
                    
                } catch (error) {
                    logResult('dragdrop-result', `Drop error: ${error.message}`, true);
                }
            });
            
            logResult('dragdrop-result', 'Drag and drop event listeners configured');
        }
        
        // Test 3: Text Processing
        function processTestText() {
            const textArea = document.getElementById('negotiation-text');
            const processedDiv = document.getElementById('processed-text');
            const text = textArea.value;
            
            if (!text.trim()) {
                logResult('processing-result', 'No text to process', true);
                return;
            }
            
            logResult('processing-result', `Processing ${text.length} characters...`);
            
            // Simulate highlighting with keyword detection
            let processedText = text;
            const patterns = [
                { pattern: /(—Ç—ñ–ª—å–∫–∏ —Å—å–æ–≥–æ–¥–Ω—ñ|–æ–±–º–µ–∂–µ–Ω–∞ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—è|–æ—Å—Ç–∞–Ω–Ω—ñ–π —à–∞–Ω—Å)/gi, class: 'highlight-manipulation', type: '–º–∞–Ω—ñ–ø—É–ª—è—Ü—ñ—è' },
                { pattern: /(–≤—Å—ñ —Ç–∞–∫ —Ä–æ–±–ª—è—Ç—å|–±—ñ–ª—å—à—ñ—Å—Ç—å –ª—é–¥–µ–π|–µ–∫—Å–ø–µ—Ä—Ç–∏ –∫–∞–∂—É—Ç—å)/gi, class: 'highlight-cognitive_bias', type: '–≤–∏–∫—Ä–∏–≤–ª–µ–Ω–Ω—è' },
                { pattern: /(–∞–±–æ\\.\\.\\.–∞–±–æ|—á–æ—Ä–Ω–æ-–±—ñ–ª—ñ —Ä—ñ—à–µ–Ω–Ω—è|–Ω–µ–º–∞—î —ñ–Ω—à–æ–≥–æ –≤–∏–±–æ—Ä—É)/gi, class: 'highlight-rhetorical_fallacy', type: '—Å–æ—Ñ—ñ–∑–º' }
            ];
            
            let foundCount = 0;
            patterns.forEach(({ pattern, class: className, type }) => {
                const matches = text.match(pattern);
                if (matches) {
                    foundCount += matches.length;
                    processedText = processedText.replace(pattern, `<span class="${className}">$1</span>`);
                    logResult('processing-result', `Found ${matches.length} instances of ${type}`);
                }
            });
            
            processedDiv.innerHTML = processedText;
            logResult('processing-result', `Processing complete. Found ${foundCount} total highlights.`);
        }
        
        // Initialize on load
        setTimeout(() => {
            logResult('highlighting-result', 'Initializing highlighting tests...');
            logResult('dragdrop-result', 'Initializing drag & drop tests...');
            logResult('processing-result', 'Text processing tests ready...');
            
            setupDragAndDrop();
            
        }, 2000);
    </script>
    
    <script src="/auth.js"></script>
    <script src="/app-neon.js"></script>
    <script src="/fix-test.js"></script>
    
    <style>
        .test-button {
            background: #a855f7;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover { background: #9333ea; }
        .error { color: #ff4444; }
        .success { color: #00ff88; }
    </style>
</body>
</html>